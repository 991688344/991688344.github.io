<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Flask-Debug-pin码生成机制 | Rick</title><meta name="author" content="LYC"><meta name="copyright" content="LYC"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="原文地址 http:&#x2F;&#x2F;www.91ri.org&#x2F;17362.html 0x01 基础环境 Windows 7 x64 Python 2.7.14 Flask 0.12.2 pdb 0x02 PIN 码生成流程分析 在分析Flask程序执行流程，直到定位到PIN码生成函数这段过程，都会大量依赖pdb，来梳理函数间的调用关系。 示例代码依旧使用上一篇文章中的测试代码： 123456789101112">
<meta property="og:type" content="article">
<meta property="og:title" content="Flask-Debug-pin码生成机制">
<meta property="og:url" content="http://991688344.github.io/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/index.html">
<meta property="og:site_name" content="Rick">
<meta property="og:description" content="原文地址 http:&#x2F;&#x2F;www.91ri.org&#x2F;17362.html 0x01 基础环境 Windows 7 x64 Python 2.7.14 Flask 0.12.2 pdb 0x02 PIN 码生成流程分析 在分析Flask程序执行流程，直到定位到PIN码生成函数这段过程，都会大量依赖pdb，来梳理函数间的调用关系。 示例代码依旧使用上一篇文章中的测试代码： 123456789101112">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://991688344.github.io/images/Wallpaper/eatham.gif">
<meta property="article:published_time" content="2020-03-24T12:51:51.000Z">
<meta property="article:modified_time" content="2024-03-19T01:32:36.450Z">
<meta property="article:author" content="LYC">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="Flask">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://991688344.github.io/images/Wallpaper/eatham.gif"><link rel="shortcut icon" href="/images/Wallpaper/favicon.ico"><link rel="canonical" href="http://991688344.github.io/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/content.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Flask-Debug-pin码生成机制',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/mycss/my_background.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-color: #F7F9FE;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">251</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">49</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/Wallpaper/eatham.gif);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Rick</span></a><a class="nav-page-title" href="/"><span class="site-name">Flask-Debug-pin码生成机制</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Flask-Debug-pin码生成机制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-03-24T12:51:51.000Z" title="发表于 2020-03-24 20:51:51">2020-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-19T01:32:36.450Z" title="更新于 2024-03-19 09:32:36">2024-03-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>5分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>原文地址 <a target="_blank" rel="noopener" href="http://www.91ri.org/17362.html">http://www.91ri.org/17362.html</a></p>
<h2 id="0x01-基础环境"><strong>0x01 基础环境</strong></h2>
<p>Windows 7 x64</p>
<p>Python 2.7.14</p>
<p>Flask 0.12.2</p>
<p>pdb</p>
<h2 id="0x02-PIN-码生成流程分析"><strong>0x02 PIN 码生成流程分析</strong></h2>
<p>在分析Flask程序执行流程，直到定位到PIN码生成函数这段过程，都会大量依赖pdb，来梳理函数间的调用关系。</p>
<p>示例代码依旧使用上一篇文章中的测试代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> Hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pdb.set_trace()</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">80</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>值得注意的是，我在第1行import pdb，第11行pdb.set_trace()，就是在app.run()函数前下断点。关于pdb的常用命令，不需要再去其他博文中补充知识。用到哪个，我都会简单介绍下。</p>
<p>第1步：启动该Flask应用（其会在app.run()函数前断掉）</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/12.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/12.jpg" alt="img"></a></p>
<p>第2步：使用s命令，进入app.run()函数中（C:\Python27\Lib\site-packages\flask[app.py](<a href="http://link.zhihu.com/?target=http%3A//app.py/">http://link.zhihu.com/?target=http%3A//app.py/</a>)第782-846行），多次输入n命令（执行下一行），抵达第841行的run_simple()函数</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/23.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/23.jpg" alt="img"></a></p>
<p>按s命令，进入run_simple()函数。多次执行n命令，抵达C:\Python27\Lib\site-packages\werkzeug[serving.py](<a href="http://link.zhihu.com/?target=http%3A//serving.py/">http://link.zhihu.com/?target=http%3A//serving.py/</a>) 第736行，创建DebuggedApplication对象的位置（即创建对象的过程会执行DebuggedApplication类的__init__构造方法）。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/32.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/32.jpg" alt="img"></a></p>
<p>按s命令，步入DebuggedApplication类的实现代码（C:\Python27\Lib\site-packages\werkzeug\debug_<em>init</em>_.py 第199-468行）中：</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/42.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/42.jpg" alt="img"></a></p>
<p>根据文件名称、类名称等可以推断出，这部分中就会有生成PIN码的关键代码。</p>
<p>顺便提一句，</p>
<p><code>Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.</code></p>
<p>Flask是基于Werkzeug和Jinja 2的Web框架。研究Flask的PIN码生成机制，就是研究Werkzeug的PIN码生成机制。</p>
<p>继续向下跟，第251行和第262行之间</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/52.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/52.jpg" alt="img"></a></p>
<p>有一个判断操作，如果PIN启用的话，及self.pin存在值，则会通过_log()函数，将PIN码打印到终端。</p>
<p>ok，那我们现在只要在程序执行到if <a href="http://link.zhihu.com/?target=http%3A//self.pin/">self.pin</a> is None:时。进入<a href="http://link.zhihu.com/?target=http%3A//self.pin/">self.pin</a>，查看其实现方式即可（这里用到了Property的概念，简单理解在Python的类中，针对类中的成员变量，提供了Property，方便定义get和set方法，方便对该变量取值和赋值。详细内容可以在参考链接中查看）。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/61.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/61.jpg" alt="img"></a></p>
<p>第266行，通过get_pin_and_cookie_name()函数对PIN码进行赋值</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/71.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/71.jpg" alt="img"></a></p>
<p>继续跟进get_pin_and_cookie_name()函数（第115-196行），重头戏来了！</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/81.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/81.jpg" alt="img"></a></p>
<p>在这个函数中，前几行定义了pin、rv、num 3个变量值为None（在调试器中使用【pp 变量名】即可查看变量值）。其中根据函数的返回值，rv的值就是我们要重点关注的PIN码，在这个函数的执行流程中，需要重点关注rv变量的赋值。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/91.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/91.jpg" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/13.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/13.jpg" alt="img"></a></p>
<p>由于PIN的值为None，so第108-137行两个if判断均不会执行，继续向下走。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/24.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/24.jpg" alt="img"></a></p>
<p>modname变量被赋值为“<a href="http://link.zhihu.com/?target=http%3A//flask.app/">flask.app</a>”</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/33.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/33.jpg" alt="img"></a></p>
<p>继续向下执行，在第145行username = getpass.getuser()，username变量被赋值为“当前登录服务器的用户名”。向下执行，mod被赋值为&lt;module ‘<a href="http://link.zhihu.com/?target=http%3A//flask.app/">flask.app</a>‘ from ‘C:\Python27\lib\site-packages\flask\app.pyc’&gt;。</p>
<p>继续向下执行，第151-168行，是生成PIN码的储备阶段，对多个变量进行了赋值。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/43.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/43.jpg" alt="img"></a></p>
<p>下图为各变量此时的值</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/53.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/53.jpg" alt="img"></a></p>
<p>通过h.hexdigest()函数可以获得h的MD5值（后面会用到）。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/62.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/62.jpg" alt="img"></a></p>
<p>根据上图的执行流程，先来看下169-174行的for循环，循环次数即为前面那一坨变量值得数量，共6次。</p>
<p>第1次循环，将“当前机器用户名”的MD5形式存入h变量中。</p>
<p>第2次循环，将“当前机器用户名”+<a href="http://link.zhihu.com/?target=http%3A//flask.app/">flask.app</a>的MD5形式存入h变量中。</p>
<p>…</p>
<p>第6次循环，将以上6个值的MD5形式存入h变量中</p>
<p>第175、182行将两个固定的字符串加入其中。变量num的值为MD5值16进制的前9位，经过187-194行代码处理，以111-222-333形式输出。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/72.jpg"><img src="/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/72.jpg" alt="img"></a></p>
<h2 id="0x03-PIN-码的生成流程安全么？"><strong>0x03 PIN 码的生成流程安全么？</strong></h2>
<p>通过0x02小结，现在已经摸清了PIN码的生成流程。我们可以知道PIN码的值由</p>
<ul>
<li><code>当前计算机用户名：XXX</code>、</li>
<li><code>[flask.app]</code>、</li>
<li><code>Flask</code>、</li>
<li><code>C:\\Python27\\lib\\site-packages\\flask\\app.pyc</code>、</li>
<li><code>str(uuid.getnode())</code>、</li>
<li><code>get_machine_id()</code>组合获得，缺一不可。</li>
</ul>
<p>【<a href="http://link.zhihu.com/?target=http%3A//flask.app/">flask.app</a>】、【Flask】已知。</p>
<p>绝对路径可以由debug页面的报错信息获得，【C:\Python27\lib\site-packages\flask\app.pyc】也能拿到。</p>
<p>现在的问题是，如何获得【当前计算机用户名：XXX】、【str(uuid.getnode())】、【get_machine_id()】3个变量的值。</p>
<p>先来看下Flask自动义的get_machine_id()函数（C:\Python27\Lib\site-packages\werkzeug\debug_<em>init</em>_.py 第51-101行）</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/82.jpg"><img src="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/82.jpg" alt="img"></a></p>
<p>返回值rv由内部的_generate()函数获得。</p>
<p>根据第60-65行，可以看到，</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/92.jpg"><img src="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/92.jpg" alt="img"></a></p>
<p>若/etc/machine-id，/proc/sys/kernel/random/boot_id文件存在，则返回文件中的值。看到这里就知道，想要预测这个值，那是没戏了。</p>
<p>因为我的测试机用的Windows，看一下对Windows这块是怎么实现的。</p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/14.jpg"><img src="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/14.jpg" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/25.jpg"><img src="http://static-js-new.test.upcdn.net/wp-content/uploads/2017/12/25.jpg" alt="img"></a></p>
<p>欢笑中打出GG。至于获取【当前计算机用户名：XXX】、【str(uuid.getnode())】的实现代码，我这里就不做过多的分析了。</p>
<h2 id="0x04-后记"><strong>0x04 后记</strong></h2>
<p>通过这次分析，可以学习到Flask的开发人员在实现PIN生成机制的过程中还是非常严谨的。至少我这里没有办法预测出指定机器的PIN码。</p>
<p>文章记录了我这次分析的过程，虽然没有找到预测PIN码的方法，但是学习到了Flask的PIN码生成机制，以及通过pdb调试代码。也算是一种收获吧。</p>
<p>当然，如果对这方面有兴趣的同学，恰好看到了我的这篇文章，希望你也能有所收获。同时，如有谬误，还请不吝赐教。</p>
<p>之后的话，我可能还会看下有没有绕过PIN码直接调用Python shell的方式、或者其他的安全问题。</p>
<p>随着Python的广泛应用，在机器学习、Web开发方面可以越来越多的看到Python的身影，Python相关的安全问题也越来越重要。我这里抛砖引玉，记录一下我的学习过程，期待各位大佬投入到相关安全问题的挖掘中来（可能很多人已经在做了），同时可以分享自己的研究成果。期待ing</p>
<h2 id="0x05-参考链接"><strong>0x05 参考链接</strong></h2>
<p><a href="http://link.zhihu.com/?target=https%3A//www.ibm.com/developerworks/cn/linux/l-cn-pythondebugger/">Python 代码调试技巧</a></p>
<p><a href="http://link.zhihu.com/?target=http%3A//flask.pocoo.org/">Flask (A Python Microframework)</a></p>
<p><a href="http://link.zhihu.com/?target=http%3A//blog.csdn.net/hshl1214/article/details/45480953">Python中的property() 函数 和@property 装饰符</a></p>
<p><a href="http://link.zhihu.com/?target=http%3A//blog.51cto.com/supermagi/1649983">Linux 内核参数详解-KERNEL</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://991688344.github.io">LYC</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://991688344.github.io/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/">http://991688344.github.io/2020/03/24/Flask-Debug-pin%E7%A0%81%E7%94%9F%E6%88%90%E6%9C%BA%E5%88%B6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://991688344.github.io" target="_blank">Rick</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a><a class="post-meta__tags" href="/tags/Flask/">Flask</a></div><div class="post-share"><div class="social-share" data-image="/images/Wallpaper/eatham.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2020/03/25/python%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8E%8Bunzip%E5%AF%BC%E8%87%B4%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" title="python文件解压unzip导致的代码执行"><img class="cover" src="/images/Wallpaper/eatham.gif" onerror="onerror=null;src='/images/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">python文件解压unzip导致的代码执行</div></div><div class="info-2"><div class="info-item-1">一、前言 ​    Python中负责解压压缩文件的代码实现上并不安全，存在目录遍历漏洞，攻击者可以利用该漏洞覆盖**init.py**文件，实现任意代码执行。 ​    在PHP中，实现代码执行最为简单的一种方式就是利用PHP中不安全的文件上传处理逻辑。如果你可以欺骗文件上传逻辑，上传任意PHP文件，那么你就可以执行任意PHP代码。然而，如果我们面对的是使用Go、Node.js、Python、Ruby等编写的现代Web框架时，情况会有所变化。这种情况下，即使我们把.py或者.js文件成功上传到服务器上，通过URL请求这些文件通常并不会返回任何结果，因为目标应用程序并没有开放相应的路由或者URL渠道。即使我们可以通过URL来访问这些资源，也不会触发任何代码执行动作，因为服务器会把这些文件当作静态文件，以文本形式返回这些文件的源代码。在本文中，我们会介绍如何在Python构造的Web环境中实现代码执行，前提是我们可以将压缩文件上传到服务器。 ​   ...</div></div></div></a><a class="pagination-related" href="/2020/03/24/%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C%E5%88%B7%E6%80%AA%E7%AC%BC/" title="我的世界刷怪笼"><img class="cover" src="/images/Wallpaper/rainbowcat.gif" onerror="onerror=null;src='/images/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">我的世界刷怪笼</div></div><div class="info-2"><div class="info-item-1">通用指令：/setblock ~ ~1 ~ minecraft:mob_spawner 0 replace {EntityId:Spider}这是一个刷蜘蛛的笼子，把EntityId后面的名字改成以下名字： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970711，攻击型生物50 32 爬行者 Creeper51 33 骷髅凋灵骷髅 Skeleton52 34 蜘蛛 Spider53 35 巨人 Giant54 36 僵尸 Zombie55 37 史莱姆 Slime56 38 恶魂 Ghast57 39 僵尸猪人 PigZombie58 3A 末影人 Enderman59 3B 洞穴蜘蛛 CaveSpider60 3C 蠹虫 Silverfish61 3D 烈焰人 Blaze62 3E 岩浆怪 LavaSlime63 3F 末影龙 EnderDragon64 40 凋灵...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2020/03/21/DDCTF2018-%E5%8C%BA%E5%9D%97%E9%93%BE/" title="DDCTF2018-区块链"><img class="cover" src="/images/Wallpaper/rainbowcat.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-21</div><div class="info-item-2">DDCTF2018-区块链</div></div><div class="info-2"><div class="info-item-1">https://xuanxuanblingbling.github.io/ctf/web/2018/05/01/DDCTF2018-WEB4-区块链/ </div></div></div></a><a class="pagination-related" href="/2019/12/08/DNS%E8%AE%B0%E5%BD%95%E7%B1%BB%E5%9E%8B/" title="DNS记录类型"><img class="cover" src="/images/Wallpaper/rainbowcat.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-08</div><div class="info-item-2">DNS记录类型</div></div><div class="info-2"><div class="info-item-1">A记录： 将域名指向一个IPv4地址（例如：100.100.100.100），需要增加A记录 CNAME记录： 如果将域名指向一个域名，实现与被指向域名相同的访问效果，需要增加CNAME记录。这个域名一般是主机服务商提供的一个域名 MX记录： 建立电子邮箱服务，将指向邮件服务器地址，需要设置MX记录。建立邮箱时，一般会根据邮箱服务商提供的MX记录填写此记录 NS记录： 域名解析服务器记录，如果要将子域名指定某个域名服务器来解析，需要设置NS记录 TXT记录： 可任意填写，可为空。一般做一些验证记录时会使用此项，如：做SPF（反垃圾邮件）记录 AAAA记录： 将主机名（或域名）指向一个IPv6地址（例如：ff03:0:0:0:0:0:0:c1），需要添加AAAA记录 SRV记录： 添加服务记录服务器服务记录时会添加此项，SRV记录了哪台计算机提供了哪个服务。格式为：服务的名字.协议的类型（例如：_example-server._tcp）。 SOA记录： SOA叫做起始授权机构记录，NS用于标识多台域名解析服务器，SOA记录用于在众多NS记录中那一台是主服务器 PTR记录：...</div></div></div></a><a class="pagination-related" href="/2020/01/14/Docker-COmpose%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6/" title="Docker-COmpose模板文件"><img class="cover" src="/images/Wallpaper/eatham.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-14</div><div class="info-item-2">Docker-COmpose模板文件</div></div><div class="info-2"><div class="info-item-1">Docker官网 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263version: &#x27;2&#x27;services:  # 基本环境  nginx:    container_name: &quot;nginx&quot;    image: nginx    build: ./nginx    command: nginx -g &#x27;daemon off;&#x27;    restart: always    # 数据卷    volumes:      - &quot;$PWD/nginx/code:/usr/share/nginx/html&quot;      - &quot;$PWD/nginx/nginx.conf:/etc/nginx/nginx.conf&quot;      -...</div></div></div></a><a class="pagination-related" href="/2020/03/15/JSON-Web-Token/" title="JSON-Web-Token"><img class="cover" src="/images/Wallpaper/rainbowcat.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-15</div><div class="info-item-2">JSON-Web-Token</div></div><div class="info-2"><div class="info-item-1">1. JSON Web Token是什么 JSON Web Token (JWT)是一个开放标准(RFC 7519)，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。 2. 什么时候你应该用JSON Web Tokens 下列场景中使用JSON Web Token是很有用的：  Authorization (授权) : 这是使用JWT的最常见场景。一旦用户登录，后续每个请求都将包含JWT，允许用户访问该令牌允许的路由、服务和资源。单点登录是现在广泛使用的JWT的一个特性，因为它的开销很小，并且可以轻松地跨域使用。 Information Exchange (信息交换) : 对于安全的在各方之间传输信息而言，JSON Web  Tokens无疑是一种很好的方式。因为JWTs可以被签名，例如，用公钥/私钥对，你可以确定发送人就是它们所说的那个人。另外，由于签名是使用头和有效负载计算的，您还可以验证内容没有被篡改。  3. JSON Web Token的结构是什么样的  JSON Web...</div></div></div></a><a class="pagination-related" href="/2020/04/19/JS%E5%8E%9F%E5%9E%8B%E5%AF%B9%E8%B1%A1/" title="JS原型对象"><img class="cover" src="/images/Wallpaper/rainbowcat.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-19</div><div class="info-item-2">JS原型对象</div></div><div class="info-2"><div class="info-item-1">一、什么是原型  原型是Javascript中的继承的基础，JavaScript的继承就是基于原型的继承。 JavaScript 常被描述为一种基于原型的语言 (prototype-based language)——每个对象拥有一个原型对象，对象以其原型为模板、从原型继承方法和属性。原型对象也可能拥有原型，并从中继承方法和属性，一层一层、以此类推。这种关系常被称为原型链 (prototype chain)，它解释了为何一个对象会拥有定义在其他对象中的属性和方法。 准确地说，这些属性和方法定义在Object的构造器函数(constructor functions)之上的prototype属性上，而非对象实例本身。 在传统的 OOP 中，首先定义“类”，此后创建对象实例时，类中定义的所有属性和方法都被复制到实例中。在 JavaScript 中并不如此复制——而是在对象实例和它的构造器之间建立一个链接（它是__proto__属性，是从构造函数的prototype属性派生的），之后通过上溯原型链，在构造器中找到这些属性和方法。 注意:...</div></div></div></a><a class="pagination-related" href="/2019/11/24/JavaIO%E6%B5%81/" title="JavaIO流"><img class="cover" src="/images/Wallpaper/eatham.gif" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-24</div><div class="info-item-2">JavaIO流</div></div><div class="info-2"><div class="info-item-1">Java中文文档    来看一下FileOutputStream：   FileOutputStream.flush()  进入后发现是直接调用其父类也就是OutputStream里面的flush()方法。也就是FileOutputStream并没有对这个方法重写。嗯~ 没啥问题。   FileOutputStream.close()  进去查看close的具体实现，发现FileOutputStream重写了基类的close()方法: 12345678910111213141516171819202122public void close() throws IOException &#123;    synchronized (closeLock) &#123;	//上个锁        if (closed) &#123;            return;        &#125;        closed = true;    &#125;         // Android-added: CloseGuard support.   ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC80NzA1My8yMzU1Mw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">LYC</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">251</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">49</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text">0x01 基础环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-PIN-%E7%A0%81%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">0x02 PIN 码生成流程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-PIN-%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B9%88%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">0x03 PIN 码的生成流程安全么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E5%90%8E%E8%AE%B0"><span class="toc-number">4.</span> <span class="toc-text">0x04 后记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">5.</span> <span class="toc-text">0x05 参考链接</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/29/4GPU%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%BB%B4%E6%8A%A4/" title="4GPU服务器环境配置及维护"><img src="/images/Wallpaper/rainbowcat.gif" onerror="this.onerror=null;this.src='/images/404.png'" alt="4GPU服务器环境配置及维护"/></a><div class="content"><a class="title" href="/2023/08/29/4GPU%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%BB%B4%E6%8A%A4/" title="4GPU服务器环境配置及维护">4GPU服务器环境配置及维护</a><time datetime="2023-08-29T12:00:26.000Z" title="发表于 2023-08-29 20:00:26">2023-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/29/UEFI-systemd%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" title="UEFI+systemd开机启动流程"><img src="/images/Wallpaper/eatham.gif" onerror="this.onerror=null;this.src='/images/404.png'" alt="UEFI+systemd开机启动流程"/></a><div class="content"><a class="title" href="/2023/08/29/UEFI-systemd%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" title="UEFI+systemd开机启动流程">UEFI+systemd开机启动流程</a><time datetime="2023-08-29T08:39:54.000Z" title="发表于 2023-08-29 16:39:54">2023-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/27/udev%E9%85%8D%E7%BD%AELinux%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3/" title="udev配置Linux网络接口"><img src="/images/Wallpaper/eatham.gif" onerror="this.onerror=null;this.src='/images/404.png'" alt="udev配置Linux网络接口"/></a><div class="content"><a class="title" href="/2023/08/27/udev%E9%85%8D%E7%BD%AELinux%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3/" title="udev配置Linux网络接口">udev配置Linux网络接口</a><time datetime="2023-08-27T12:49:29.000Z" title="发表于 2023-08-27 20:49:29">2023-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/27/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" title="实验室服务器网络运维"><img src="/images/Wallpaper/eatham.gif" onerror="this.onerror=null;this.src='/images/404.png'" alt="实验室服务器网络运维"/></a><div class="content"><a class="title" href="/2023/08/27/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" title="实验室服务器网络运维">实验室服务器网络运维</a><time datetime="2023-08-27T12:20:23.000Z" title="发表于 2023-08-27 20:20:23">2023-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/21/Attention%E6%9C%BA%E5%88%B6-transformer/" title="Attention机制_transformer"><img src="/images/Wallpaper/eatham.gif" onerror="this.onerror=null;this.src='/images/404.png'" alt="Attention机制_transformer"/></a><div class="content"><a class="title" href="/2022/11/21/Attention%E6%9C%BA%E5%88%B6-transformer/" title="Attention机制_transformer">Attention机制_transformer</a><time datetime="2022-11-21T11:55:15.000Z" title="发表于 2022-11-21 19:55:15">2022-11-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By LYC</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo

  const loadLivere = (el, path) => {
    window.livereOptions = {
      refer: path || location.pathname
    }

    if (isShuoshuo) {
      window.shuoshuoComment.destroyLivere = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if (isShuoshuo) {
    'Livere' === 'Livere'
      ? window.shuoshuoComment = { loadComment: loadLivere }
      : window.loadOtherComment = loadLivere
    return
  }

  if ('Livere' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>